
# SPI
所谓SPI是指一个主控制器和多个从设备，通过连接的数据线进行数据传输。
SPI设备包括1个时钟，3线或者2线的。 3线的SPI设备使用两条独立的输入和输出线，是全双工的，而2线的SPI设备使用一条数据线作为输入输出数据线，是半双工的。
时钟线直接与从设备相连，构成同步。
如果有多个从设备，则CS[0:n]选择哪个设备被启用。注意，CS是低有效。

主机提供了对SPI主设备进行控制的寄存器组，每个寄存器都是32位的，依次是CS,FIFO,CLK,DLEN,LTOH,DC

CLK寄存器的低16位(CDIV), 设备的时钟 = core的时钟/CDIV

# zcu102的SPI操作

SPI控制器支持3种模式：主模式，多主设备模式，从设备模式

SPI的每个FIFO都是128字节长。

主设备模式：控制器每次选择3条从设备线之间的一个，进行数据传输。

数据传输：数据传输使用TXFIFO，通过寄存器写设置。数据会被输出到MOSI(masster output)， 数据从MISO线接收到RXFIFO,通过寄存器读将数据读出。

数据传输可以是手动开始，也可以是自动开始的。

手动/自动选择从设备：如果spi.Config[Manual_CS] == 1,则软件必须显示地启用或禁用从设备；如果该位为0，则在数据传输期间自动启用。（即写入TXFIFO自动启用，自动传输，完成后禁用）
在自动模式下，软件必须连续性地从RXFIFO中读取数据，避免溢出。

手动开始传输数据：spi.Config[Man_start_en]==1.
命令：软件通过写入spi.Config[man_start_com]=1来开始传输命令，控制器开始传输TXFIFO中的所有数据。该位在传输结束后自动清除。写入0没有影响。如果Man_start_en=0,该位没有影响。
